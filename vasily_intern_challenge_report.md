# VASILYインターン課題
- 今回の課題では, 映画を推薦するシステムを想定し, そのアルゴリズムの実装に取り組みます.
- 想定する状況としては, 任意のユーザーは既に幾つかのレビューを行っていると考え,ユーザーの観た映画とレビュー値から, 推薦を行う事とする.

## 1.協調フィルタリング
- 今回の実装には協調フィルタリングを使用しました.
- 協調フィルタリングはECサイトなどで使われている推薦アルゴリズムの1つです.
- 協調フィルタリングには大きく3つのステップがあります.
	1. 以下のようなユーザーとレビューのテーブルを用意する
		- ![テーブル](https://gyazo.com/fba80e39258f6bf994012b2da10e62f9.png)
	2. 推薦を行うために, 各ユーザとの相関を求める
		- userXと各ユーザーのレビュー値の相関を求める
		- 今回はピアソンの積率相関係数を使う
			- ![相関係数](https://gyazo.com/75368d8bd9fb0246a6c343376b543a20.png)
			- 分母はxの標準偏差とyの標準偏差をかけ合わせた値,　分子はxとyの共分散となる
		- 相関の計算には含めない, 両方のユーザーが観ている映画のレビューのみを使う
		- ![相関テーブル](https://gyazo.com/397422fe136f18aae6189e74f605b8f9.png)
		- 上図の例では, user3との相関が強い事が解る
	3. 相関の強いユーザーのアイテムを推薦する
		- 上図の例では, userXがitem6を未評価なので, item6をuserXに推薦する
		- ![推薦テーブル](https://gyazo.com/bc92b5646e8c300f6da8424d06919140.png)

## 2.実装
- [Jupyte notebook](https://github.com/ohmuraken/vasily_intern_challenge/blob/master/vasily_intern_challenge.ipynb)を参照して下さい.

## 3.改善案
- 今回の実装ではユーザーの職業や性別といった素性を利用する事ができなかった. 予めユーザーをクラスタリングしておき, 各クラスで特に評価されている映画を協調フィルタリングの際に利用したい. 例えば,相関の高さが同じ様なユーザーが複数いる際に, そのユーザー達の素性と, 推薦したいユーザーの素性を比べ, 相関が高いユーザーの中で, 素性が近いユーザーから推薦するアイテムを採用する. 
- 協調フィルタリングではユーザーを表す行列(ユーザー,レビュー値)がスパースになりがちだった. そこで, Matrix Factorizationでは各ユーザーを表す行列(ユーザー,レビュー値)を分解し, 次元を圧縮した状態の行列でユーザーを表現する事できる.
- 以下でMatrix Factorizationの式の導出を考える.
	- ![MF](https://gyazo.com/5dcd04d9de3ea4d1e355c9d1a62cd366.png)
	- (1)の式では, 行列(ユーザー,レビュー値)RをPとQに分けた
		- Pの各要素(p)はユーザーの任意の特徴の大きさを表している
		- Qの各要素(q)は,ユーザーの特徴とアイテムの評価の関係の大きさを表している
		- 以降の数式で, 最適なPとQを見つけていく
	- (2)の式では, PとQによるRの近似値を表している
	- (3)の式では, (2)のRの近似と, 実際のRとの2乗誤差を表している
		- 目的は, この誤差を最小にする様に,実際のRに近い値になるような,PとQを見つける事である
	- (4)と(5)の式では, (3)で定義した目的関数をPとQの要素で微分している (合成関数の微分に注意)
	- (6)と(7)の式では, (4)と(5)の微分で出した傾き分だけ, pとqを更新していく
	- 更新が収束した段階で学習が終了となる
	- **参考** (数式の画像の引用元)
		- [Matrix Factorization: A Simple Tutorial and Implementation in Python,  Albert Au Yeung on September 16, 2010](http://www.quuxlabs.com/blog/2010/09/matrix-factorization-a-simple-tutorial-and-implementation-in-python/)